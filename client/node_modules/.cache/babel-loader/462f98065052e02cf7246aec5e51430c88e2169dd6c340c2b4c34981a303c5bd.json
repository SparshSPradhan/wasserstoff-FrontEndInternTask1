{"ast":null,"code":"import React,{useEffect,useRef,useState,useCallback}from'react';import{useSocket}from'../context/SocketContext';import CursorOverlay from'./CursorOverlay';import'../styles/Editor.css';import debounce from'lodash.debounce';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Editor=()=>{const{documentState,updateContent,updateCursorPosition}=useSocket();const[content,setContent]=useState('');const editorRef=useRef(null);// Debounced function to emit content changes\nconst debouncedUpdateContent=useCallback(debounce(newContent=>{updateContent(newContent);},500),[]);// Update local content when document state changes\nuseEffect(()=>{if(documentState!==null&&documentState!==void 0&&documentState.content&&editorRef.current&&documentState.content!==editorRef.current.innerText){editorRef.current.innerText=documentState.content;}},[documentState]);// Handle content changes\nconst handleContentChange=e=>{const newContent=e.currentTarget.innerText;setContent(newContent);debouncedUpdateContent(newContent);};// Track cursor position\nconst handleCursorPosition=()=>{const selection=window.getSelection();if(!selection||!selection.anchorNode||!editorRef.current)return;const range=selection.getRangeAt(0);const preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(editorRef.current);preCaretRange.setEnd(range.endContainer,range.endOffset);const textBeforeCaret=preCaretRange.toString();const lines=textBeforeCaret.split('\\n');const line=lines.length-1;const ch=lines[lines.length-1].length;updateCursorPosition({line,ch});};return/*#__PURE__*/_jsxs(\"div\",{className:\"editor-container\",children:[/*#__PURE__*/_jsx(\"div\",{ref:editorRef,className:\"editor-area\",contentEditable:true,suppressContentEditableWarning:true,onInput:handleContentChange,onKeyUp:handleCursorPosition,onMouseUp:handleCursorPosition}),/*#__PURE__*/_jsx(CursorOverlay,{editorRef:editorRef})]});};export default Editor;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useSocket","CursorOverlay","debounce","jsx","_jsx","jsxs","_jsxs","Editor","documentState","updateContent","updateCursorPosition","content","setContent","editorRef","debouncedUpdateContent","newContent","current","innerText","handleContentChange","e","currentTarget","handleCursorPosition","selection","window","getSelection","anchorNode","range","getRangeAt","preCaretRange","cloneRange","selectNodeContents","setEnd","endContainer","endOffset","textBeforeCaret","toString","lines","split","line","length","ch","className","children","ref","contentEditable","suppressContentEditableWarning","onInput","onKeyUp","onMouseUp"],"sources":["/Users/sparshs.pradhan/collaborative-editor/client/src/components/Editor.tsx"],"sourcesContent":["\n\n\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useSocket } from '../context/SocketContext';\nimport CursorOverlay from './CursorOverlay';\nimport '../styles/Editor.css';\nimport debounce from 'lodash.debounce';\n\nconst Editor: React.FC = () => {\n  const { documentState, updateContent, updateCursorPosition } = useSocket();\n  const [content, setContent] = useState<string>('');\n  const editorRef = useRef<HTMLDivElement>(null);\n\n  // Debounced function to emit content changes\n  const debouncedUpdateContent = useCallback(\n    debounce((newContent: string) => {\n      updateContent(newContent);\n    }, 500),\n    []\n  );\n\n  // Update local content when document state changes\n  useEffect(() => {\n    if (\n      documentState?.content &&\n      editorRef.current &&\n      documentState.content !== editorRef.current.innerText\n    ) {\n      editorRef.current.innerText = documentState.content;\n    }\n  }, [documentState]);\n\n  // Handle content changes\n  const handleContentChange = (e: React.FormEvent<HTMLDivElement>) => {\n    const newContent = e.currentTarget.innerText;\n    setContent(newContent);\n    debouncedUpdateContent(newContent);\n  };\n\n  // Track cursor position\n  const handleCursorPosition = () => {\n    const selection = window.getSelection();\n    if (!selection || !selection.anchorNode || !editorRef.current) return;\n\n    const range = selection.getRangeAt(0);\n    const preCaretRange = range.cloneRange();\n    preCaretRange.selectNodeContents(editorRef.current);\n    preCaretRange.setEnd(range.endContainer, range.endOffset);\n    const textBeforeCaret = preCaretRange.toString();\n\n    const lines = textBeforeCaret.split('\\n');\n    const line = lines.length - 1;\n    const ch = lines[lines.length - 1].length;\n\n    updateCursorPosition({ line, ch });\n  };\n\n  return (\n    <div className=\"editor-container\">\n      <div\n        ref={editorRef}\n        className=\"editor-area\"\n        contentEditable={true}\n        suppressContentEditableWarning={true}\n        onInput={handleContentChange}\n        onKeyUp={handleCursorPosition}\n        onMouseUp={handleCursorPosition}\n      />\n      <CursorOverlay editorRef={editorRef} />\n    </div>\n  );\n};\n\nexport default Editor;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}